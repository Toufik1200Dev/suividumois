{"ast":null,"code":"import{collection,getDocs,query,where}from'firebase/firestore';import{db}from'./config';// Export all employees data to a single CSV file\nexport const exportAllEmployeesDataToCSV=async()=>{try{// Get all users\nconst usersRef=collection(db,'users');const usersSnapshot=await getDocs(usersRef);const allEmployeesData=[];for(const userDoc of usersSnapshot.docs){const userData=userDoc.data();if(userData.role==='employee'){// Get all monthly data for this employee\nconst monthlyDataRef=collection(db,'monthlyData');const q=query(monthlyDataRef,where('userId','==',userData.uid));const querySnapshot=await getDocs(q);querySnapshot.forEach(doc=>{const monthlyData=doc.data();const{data}=monthlyData;// Process each day's data\nObject.keys(data).forEach(dateString=>{const dayData=data[dateString];if(dayData&&dayData.activities&&dayData.activities.length>0){// Create a row for each activity\ndayData.activities.forEach(activity=>{var _dayData$absence,_dayData$absence2,_dayData$absence3;const row={'Nom du collaborat':\"\".concat(userData.firstName,\" \").concat(userData.lastName),'Date':formatDate(dateString),'Client':activity.client,'Activité':activity.activity,'Somme':'1','TTV':'0','TR':((_dayData$absence=dayData.absence)===null||_dayData$absence===void 0?void 0:_dayData$absence.restaurantTicket)==='1'?'1':'0','Absence':((_dayData$absence2=dayData.absence)===null||_dayData$absence2===void 0?void 0:_dayData$absence2.type)==='Présent'?'':((_dayData$absence3=dayData.absence)===null||_dayData$absence3===void 0?void 0:_dayData$absence3.type)||''};allEmployeesData.push(row);});}else if(dayData&&dayData.absence&&dayData.absence.type!=='Présent'){var _dayData$absence4,_dayData$absence5;// Handle absence days without activities\nconst row={'Nom du collaborat':\"\".concat(userData.firstName,\" \").concat(userData.lastName),'Date':formatDate(dateString),'Client':'','Activité':'','Somme':'1','TTV':'0','TR':((_dayData$absence4=dayData.absence)===null||_dayData$absence4===void 0?void 0:_dayData$absence4.restaurantTicket)==='1'?'1':'0','Absence':((_dayData$absence5=dayData.absence)===null||_dayData$absence5===void 0?void 0:_dayData$absence5.type)||''};allEmployeesData.push(row);}});});}}// Sort by employee name first, then by date\nallEmployeesData.sort((a,b)=>{const nameCompare=a['Nom du collaborat'].localeCompare(b['Nom du collaborat']);if(nameCompare!==0)return nameCompare;return new Date(a.Date.split('/').reverse().join('-'))-new Date(b.Date.split('/').reverse().join('-'));});return{success:true,data:allEmployeesData};}catch(error){console.error('Error exporting all employees data:',error);return{success:false,error:error.message};}};// Convert CSV data to downloadable file\nexport const downloadCSV=(data,filename)=>{if(!data||data.length===0){throw new Error('No data to export');}const headers=Object.keys(data[0]);const csvContent=[headers.join(','),...data.map(row=>headers.map(header=>{const value=row[header]||'';// Escape commas and quotes in CSV\nreturn\"\\\"\".concat(value.toString().replace(/\"/g,'\"\"'),\"\\\"\");}).join(','))].join('\\n');const blob=new Blob([csvContent],{type:'text/csv;charset=utf-8;'});const link=document.createElement('a');const url=URL.createObjectURL(blob);link.setAttribute('href',url);link.setAttribute('download',filename);link.style.visibility='hidden';document.body.appendChild(link);link.click();document.body.removeChild(link);URL.revokeObjectURL(url);};// Format date from YYYY-MM-DD to DD/MM/YYYY\nconst formatDate=dateString=>{const[year,month,day]=dateString.split('-');return\"\".concat(day,\"/\").concat(month,\"/\").concat(year);};","map":{"version":3,"names":["collection","getDocs","query","where","db","exportAllEmployeesDataToCSV","usersRef","usersSnapshot","allEmployeesData","userDoc","docs","userData","data","role","monthlyDataRef","q","uid","querySnapshot","forEach","doc","monthlyData","Object","keys","dateString","dayData","activities","length","activity","_dayData$absence","_dayData$absence2","_dayData$absence3","row","concat","firstName","lastName","formatDate","client","absence","restaurantTicket","type","push","_dayData$absence4","_dayData$absence5","sort","a","b","nameCompare","localeCompare","Date","split","reverse","join","success","error","console","message","downloadCSV","filename","Error","headers","csvContent","map","header","value","toString","replace","blob","Blob","link","document","createElement","url","URL","createObjectURL","setAttribute","style","visibility","body","appendChild","click","removeChild","revokeObjectURL","year","month","day"],"sources":["C:/Users/rahma/OneDrive/Desktop/suivi du mois/src/firebase/exportService.js"],"sourcesContent":["import { collection, getDocs, query, where } from 'firebase/firestore';\r\nimport { db } from './config';\r\n\r\n// Export all employees data to a single CSV file\r\nexport const exportAllEmployeesDataToCSV = async () => {\r\n  try {\r\n    // Get all users\r\n    const usersRef = collection(db, 'users');\r\n    const usersSnapshot = await getDocs(usersRef);\r\n    \r\n    const allEmployeesData = [];\r\n    \r\n    for (const userDoc of usersSnapshot.docs) {\r\n      const userData = userDoc.data();\r\n      if (userData.role === 'employee') {\r\n        // Get all monthly data for this employee\r\n        const monthlyDataRef = collection(db, 'monthlyData');\r\n        const q = query(monthlyDataRef, where('userId', '==', userData.uid));\r\n        const querySnapshot = await getDocs(q);\r\n        \r\n        querySnapshot.forEach((doc) => {\r\n          const monthlyData = doc.data();\r\n          const { data } = monthlyData;\r\n          \r\n          // Process each day's data\r\n          Object.keys(data).forEach(dateString => {\r\n            const dayData = data[dateString];\r\n            if (dayData && dayData.activities && dayData.activities.length > 0) {\r\n              // Create a row for each activity\r\n              dayData.activities.forEach(activity => {\r\n                const row = {\r\n                  'Nom du collaborat': `${userData.firstName} ${userData.lastName}`,\r\n                  'Date': formatDate(dateString),\r\n                  'Client': activity.client,\r\n                  'Activité': activity.activity,\r\n                  'Somme': '1',\r\n                  'TTV': '0',\r\n                  'TR': dayData.absence?.restaurantTicket === '1' ? '1' : '0',\r\n                  'Absence': dayData.absence?.type === 'Présent' ? '' : (dayData.absence?.type || '')\r\n                };\r\n                allEmployeesData.push(row);\r\n              });\r\n            } else if (dayData && dayData.absence && dayData.absence.type !== 'Présent') {\r\n              // Handle absence days without activities\r\n              const row = {\r\n                'Nom du collaborat': `${userData.firstName} ${userData.lastName}`,\r\n                'Date': formatDate(dateString),\r\n                'Client': '',\r\n                'Activité': '',\r\n                'Somme': '1',\r\n                'TTV': '0',\r\n                'TR': dayData.absence?.restaurantTicket === '1' ? '1' : '0',\r\n                'Absence': dayData.absence?.type || ''\r\n              };\r\n              allEmployeesData.push(row);\r\n            }\r\n          });\r\n        });\r\n      }\r\n    }\r\n    \r\n    // Sort by employee name first, then by date\r\n    allEmployeesData.sort((a, b) => {\r\n      const nameCompare = a['Nom du collaborat'].localeCompare(b['Nom du collaborat']);\r\n      if (nameCompare !== 0) return nameCompare;\r\n      return new Date(a.Date.split('/').reverse().join('-')) - new Date(b.Date.split('/').reverse().join('-'));\r\n    });\r\n    \r\n    return {\r\n      success: true,\r\n      data: allEmployeesData\r\n    };\r\n  } catch (error) {\r\n    console.error('Error exporting all employees data:', error);\r\n    return {\r\n      success: false,\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\n// Convert CSV data to downloadable file\r\nexport const downloadCSV = (data, filename) => {\r\n  if (!data || data.length === 0) {\r\n    throw new Error('No data to export');\r\n  }\r\n  \r\n  const headers = Object.keys(data[0]);\r\n  const csvContent = [\r\n    headers.join(','),\r\n    ...data.map(row => \r\n      headers.map(header => {\r\n        const value = row[header] || '';\r\n        // Escape commas and quotes in CSV\r\n        return `\"${value.toString().replace(/\"/g, '\"\"')}\"`;\r\n      }).join(',')\r\n    )\r\n  ].join('\\n');\r\n  \r\n  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n  const link = document.createElement('a');\r\n  const url = URL.createObjectURL(blob);\r\n  \r\n  link.setAttribute('href', url);\r\n  link.setAttribute('download', filename);\r\n  link.style.visibility = 'hidden';\r\n  \r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  \r\n  URL.revokeObjectURL(url);\r\n};\r\n\r\n// Format date from YYYY-MM-DD to DD/MM/YYYY\r\nconst formatDate = (dateString) => {\r\n  const [year, month, day] = dateString.split('-');\r\n  return `${day}/${month}/${year}`;\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}