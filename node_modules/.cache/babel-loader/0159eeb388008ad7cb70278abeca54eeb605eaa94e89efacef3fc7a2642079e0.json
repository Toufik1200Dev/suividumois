{"ast":null,"code":"import{collection,getDocs,query,where}from'firebase/firestore';import{db}from'./config';// Export employee data to CSV format\nexport const exportEmployeeDataToCSV=async(employeeId,employeeName)=>{try{// Get all monthly data for the employee\nconst monthlyDataRef=collection(db,'monthlyData');const q=query(monthlyDataRef,where('userId','==',employeeId));const querySnapshot=await getDocs(q);const allData=[];querySnapshot.forEach(doc=>{const monthlyData=doc.data();const{year,month,data}=monthlyData;// Process each day's data\nObject.keys(data).forEach(dateString=>{const dayData=data[dateString];if(dayData&&dayData.activities&&dayData.activities.length>0){// Create a row for each activity\ndayData.activities.forEach(activity=>{var _dayData$absence,_dayData$absence2,_dayData$absence3;const row={'Nom du collaborat':employeeName,'Date':formatDate(dateString),'Client':activity.client,'Activité':activity.activity,'Somme':'1','TTV':'0','TR':((_dayData$absence=dayData.absence)===null||_dayData$absence===void 0?void 0:_dayData$absence.restaurantTicket)==='1'?'1':'0','Absence':((_dayData$absence2=dayData.absence)===null||_dayData$absence2===void 0?void 0:_dayData$absence2.type)==='Présent'?'':((_dayData$absence3=dayData.absence)===null||_dayData$absence3===void 0?void 0:_dayData$absence3.type)||''};allData.push(row);});}else if(dayData&&dayData.absence&&dayData.absence.type!=='Présent'){var _dayData$absence4,_dayData$absence5;// Handle absence days without activities\nconst row={'Nom du collaborat':employeeName,'Date':formatDate(dateString),'Client':'','Activité':'','Somme':'1','TTV':'0','TR':((_dayData$absence4=dayData.absence)===null||_dayData$absence4===void 0?void 0:_dayData$absence4.restaurantTicket)==='1'?'1':'0','Absence':((_dayData$absence5=dayData.absence)===null||_dayData$absence5===void 0?void 0:_dayData$absence5.type)||''};allData.push(row);}});});// Sort by date\nallData.sort((a,b)=>new Date(a.Date.split('/').reverse().join('-'))-new Date(b.Date.split('/').reverse().join('-')));return{success:true,data:allData};}catch(error){console.error('Error exporting employee data:',error);return{success:false,error:error.message};}};// Export all employees data to CSV\nexport const exportAllEmployeesDataToCSV=async()=>{try{// Get all users\nconst usersRef=collection(db,'users');const usersSnapshot=await getDocs(usersRef);const allEmployeesData=[];for(const userDoc of usersSnapshot.docs){const userData=userDoc.data();if(userData.role==='employee'){const employeeData=await exportEmployeeDataToCSV(userData.uid,\"\".concat(userData.firstName,\" \").concat(userData.lastName));if(employeeData.success){allEmployeesData.push(...employeeData.data);}}}// Sort by employee name first, then by date\nallEmployeesData.sort((a,b)=>{const nameCompare=a['Nom du collaborat'].localeCompare(b['Nom du collaborat']);if(nameCompare!==0)return nameCompare;return new Date(a.Date.split('/').reverse().join('-'))-new Date(b.Date.split('/').reverse().join('-'));});return{success:true,data:allEmployeesData};}catch(error){console.error('Error exporting all employees data:',error);return{success:false,error:error.message};}};// Convert CSV data to downloadable file\nexport const downloadCSV=(data,filename)=>{if(!data||data.length===0){throw new Error('No data to export');}const headers=Object.keys(data[0]);const csvContent=[headers.join(','),...data.map(row=>headers.map(header=>{const value=row[header]||'';// Escape commas and quotes in CSV\nreturn\"\\\"\".concat(value.toString().replace(/\"/g,'\"\"'),\"\\\"\");}).join(','))].join('\\n');const blob=new Blob([csvContent],{type:'text/csv;charset=utf-8;'});const link=document.createElement('a');const url=URL.createObjectURL(blob);link.setAttribute('href',url);link.setAttribute('download',filename);link.style.visibility='hidden';document.body.appendChild(link);link.click();document.body.removeChild(link);URL.revokeObjectURL(url);};// Format date from YYYY-MM-DD to DD/MM/YYYY\nconst formatDate=dateString=>{const[year,month,day]=dateString.split('-');return\"\".concat(day,\"/\").concat(month,\"/\").concat(year);};","map":{"version":3,"names":["collection","getDocs","query","where","db","exportEmployeeDataToCSV","employeeId","employeeName","monthlyDataRef","q","querySnapshot","allData","forEach","doc","monthlyData","data","year","month","Object","keys","dateString","dayData","activities","length","activity","_dayData$absence","_dayData$absence2","_dayData$absence3","row","formatDate","client","absence","restaurantTicket","type","push","_dayData$absence4","_dayData$absence5","sort","a","b","Date","split","reverse","join","success","error","console","message","exportAllEmployeesDataToCSV","usersRef","usersSnapshot","allEmployeesData","userDoc","docs","userData","role","employeeData","uid","concat","firstName","lastName","nameCompare","localeCompare","downloadCSV","filename","Error","headers","csvContent","map","header","value","toString","replace","blob","Blob","link","document","createElement","url","URL","createObjectURL","setAttribute","style","visibility","body","appendChild","click","removeChild","revokeObjectURL","day"],"sources":["C:/Users/rahma/OneDrive/Desktop/suivi du mois/src/firebase/exportService.js"],"sourcesContent":["import { collection, getDocs, query, where } from 'firebase/firestore';\r\nimport { db } from './config';\r\n\r\n// Export employee data to CSV format\r\nexport const exportEmployeeDataToCSV = async (employeeId, employeeName) => {\r\n  try {\r\n    // Get all monthly data for the employee\r\n    const monthlyDataRef = collection(db, 'monthlyData');\r\n    const q = query(monthlyDataRef, where('userId', '==', employeeId));\r\n    const querySnapshot = await getDocs(q);\r\n    \r\n    const allData = [];\r\n    \r\n    querySnapshot.forEach((doc) => {\r\n      const monthlyData = doc.data();\r\n      const { year, month, data } = monthlyData;\r\n      \r\n      // Process each day's data\r\n      Object.keys(data).forEach(dateString => {\r\n        const dayData = data[dateString];\r\n        if (dayData && dayData.activities && dayData.activities.length > 0) {\r\n          // Create a row for each activity\r\n          dayData.activities.forEach(activity => {\r\n            const row = {\r\n              'Nom du collaborat': employeeName,\r\n              'Date': formatDate(dateString),\r\n              'Client': activity.client,\r\n              'Activité': activity.activity,\r\n              'Somme': '1',\r\n              'TTV': '0',\r\n              'TR': dayData.absence?.restaurantTicket === '1' ? '1' : '0',\r\n              'Absence': dayData.absence?.type === 'Présent' ? '' : (dayData.absence?.type || '')\r\n            };\r\n            allData.push(row);\r\n          });\r\n        } else if (dayData && dayData.absence && dayData.absence.type !== 'Présent') {\r\n          // Handle absence days without activities\r\n          const row = {\r\n            'Nom du collaborat': employeeName,\r\n            'Date': formatDate(dateString),\r\n            'Client': '',\r\n            'Activité': '',\r\n            'Somme': '1',\r\n            'TTV': '0',\r\n            'TR': dayData.absence?.restaurantTicket === '1' ? '1' : '0',\r\n            'Absence': dayData.absence?.type || ''\r\n          };\r\n          allData.push(row);\r\n        }\r\n      });\r\n    });\r\n    \r\n    // Sort by date\r\n    allData.sort((a, b) => new Date(a.Date.split('/').reverse().join('-')) - new Date(b.Date.split('/').reverse().join('-')));\r\n    \r\n    return {\r\n      success: true,\r\n      data: allData\r\n    };\r\n  } catch (error) {\r\n    console.error('Error exporting employee data:', error);\r\n    return {\r\n      success: false,\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\n// Export all employees data to CSV\r\nexport const exportAllEmployeesDataToCSV = async () => {\r\n  try {\r\n    // Get all users\r\n    const usersRef = collection(db, 'users');\r\n    const usersSnapshot = await getDocs(usersRef);\r\n    \r\n    const allEmployeesData = [];\r\n    \r\n    for (const userDoc of usersSnapshot.docs) {\r\n      const userData = userDoc.data();\r\n      if (userData.role === 'employee') {\r\n        const employeeData = await exportEmployeeDataToCSV(userData.uid, `${userData.firstName} ${userData.lastName}`);\r\n        if (employeeData.success) {\r\n          allEmployeesData.push(...employeeData.data);\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Sort by employee name first, then by date\r\n    allEmployeesData.sort((a, b) => {\r\n      const nameCompare = a['Nom du collaborat'].localeCompare(b['Nom du collaborat']);\r\n      if (nameCompare !== 0) return nameCompare;\r\n      return new Date(a.Date.split('/').reverse().join('-')) - new Date(b.Date.split('/').reverse().join('-'));\r\n    });\r\n    \r\n    return {\r\n      success: true,\r\n      data: allEmployeesData\r\n    };\r\n  } catch (error) {\r\n    console.error('Error exporting all employees data:', error);\r\n    return {\r\n      success: false,\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\n// Convert CSV data to downloadable file\r\nexport const downloadCSV = (data, filename) => {\r\n  if (!data || data.length === 0) {\r\n    throw new Error('No data to export');\r\n  }\r\n  \r\n  const headers = Object.keys(data[0]);\r\n  const csvContent = [\r\n    headers.join(','),\r\n    ...data.map(row => \r\n      headers.map(header => {\r\n        const value = row[header] || '';\r\n        // Escape commas and quotes in CSV\r\n        return `\"${value.toString().replace(/\"/g, '\"\"')}\"`;\r\n      }).join(',')\r\n    )\r\n  ].join('\\n');\r\n  \r\n  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n  const link = document.createElement('a');\r\n  const url = URL.createObjectURL(blob);\r\n  \r\n  link.setAttribute('href', url);\r\n  link.setAttribute('download', filename);\r\n  link.style.visibility = 'hidden';\r\n  \r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  \r\n  URL.revokeObjectURL(url);\r\n};\r\n\r\n// Format date from YYYY-MM-DD to DD/MM/YYYY\r\nconst formatDate = (dateString) => {\r\n  const [year, month, day] = dateString.split('-');\r\n  return `${day}/${month}/${year}`;\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}