{"ast":null,"code":"import{createUserWithEmailAndPassword,signInWithEmailAndPassword,signOut,onAuthStateChanged,updateProfile}from'firebase/auth';import{doc,setDoc,getDoc}from'firebase/firestore';import{auth,db}from'./config';// Hash password using a simple hash function (in production, use bcrypt or similar)\nconst hashPassword=async password=>{const encoder=new TextEncoder();const data=encoder.encode(password);const hashBuffer=await crypto.subtle.digest('SHA-256',data);const hashArray=Array.from(new Uint8Array(hashBuffer));return hashArray.map(b=>b.toString(16).padStart(2,'0')).join('');};// Register a new user\nexport const registerUser=async userData=>{try{const{email,password,firstName,lastName,position}=userData;// Create user with Firebase Auth\nconst userCredential=await createUserWithEmailAndPassword(auth,email,password);const user=userCredential.user;// Hash the password for storage\nconst hashedPassword=await hashPassword(password);// Update user profile\nawait updateProfile(user,{displayName:\"\".concat(firstName,\" \").concat(lastName)});// Determine user role (admin if email contains 'admin' or 'administrateur')\nconst role=email.toLowerCase().includes('admin')||email.toLowerCase().includes('administrateur')?'admin':'employee';// Save additional user data to Firestore\nawait setDoc(doc(db,'users',user.uid),{uid:user.uid,email:email,firstName:firstName,lastName:lastName,position:position,role:role,hashedPassword:hashedPassword,// Store hashed password\ncreatedAt:new Date(),isActive:true});return{success:true,user:{uid:user.uid,email:user.email,displayName:user.displayName,role:role}};}catch(error){console.error('Registration error:',error);return{success:false,error:error.message};}};// Sign in user\nexport const signInUser=async(email,password)=>{try{const userCredential=await signInWithEmailAndPassword(auth,email,password);const user=userCredential.user;// Get user data from Firestore\nconst userDoc=await getDoc(doc(db,'users',user.uid));const userData=userDoc.data();return{success:true,user:{uid:user.uid,email:user.email,displayName:user.displayName,role:(userData===null||userData===void 0?void 0:userData.role)||'employee',firstName:userData===null||userData===void 0?void 0:userData.firstName,lastName:userData===null||userData===void 0?void 0:userData.lastName,position:userData===null||userData===void 0?void 0:userData.position}};}catch(error){console.error('Sign in error:',error);return{success:false,error:error.message};}};// Sign out user\nexport const signOutUser=async()=>{try{await signOut(auth);return{success:true};}catch(error){console.error('Sign out error:',error);return{success:false,error:error.message};}};// Listen to auth state changes\nexport const onAuthStateChange=callback=>{return onAuthStateChanged(auth,callback);};// Get current user\nexport const getCurrentUser=()=>{return auth.currentUser;};","map":{"version":3,"names":["createUserWithEmailAndPassword","signInWithEmailAndPassword","signOut","onAuthStateChanged","updateProfile","doc","setDoc","getDoc","auth","db","hashPassword","password","encoder","TextEncoder","data","encode","hashBuffer","crypto","subtle","digest","hashArray","Array","from","Uint8Array","map","b","toString","padStart","join","registerUser","userData","email","firstName","lastName","position","userCredential","user","hashedPassword","displayName","concat","role","toLowerCase","includes","uid","createdAt","Date","isActive","success","error","console","message","signInUser","userDoc","signOutUser","onAuthStateChange","callback","getCurrentUser","currentUser"],"sources":["C:/Users/rahma/OneDrive/Desktop/suivi du mois/src/firebase/authService.js"],"sourcesContent":["import { \r\n  createUserWithEmailAndPassword, \r\n  signInWithEmailAndPassword, \r\n  signOut, \r\n  onAuthStateChanged,\r\n  updateProfile\r\n} from 'firebase/auth';\r\nimport { doc, setDoc, getDoc } from 'firebase/firestore';\r\nimport { auth, db } from './config';\r\n\r\n// Hash password using a simple hash function (in production, use bcrypt or similar)\r\nconst hashPassword = async (password) => {\r\n  const encoder = new TextEncoder();\r\n  const data = encoder.encode(password);\r\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\r\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\r\n};\r\n\r\n// Register a new user\r\nexport const registerUser = async (userData) => {\r\n  try {\r\n    const { email, password, firstName, lastName, position } = userData;\r\n    \r\n    // Create user with Firebase Auth\r\n    const userCredential = await createUserWithEmailAndPassword(auth, email, password);\r\n    const user = userCredential.user;\r\n    \r\n    // Hash the password for storage\r\n    const hashedPassword = await hashPassword(password);\r\n    \r\n    // Update user profile\r\n    await updateProfile(user, {\r\n      displayName: `${firstName} ${lastName}`\r\n    });\r\n    \r\n    // Determine user role (admin if email contains 'admin' or 'administrateur')\r\n    const role = email.toLowerCase().includes('admin') || email.toLowerCase().includes('administrateur') ? 'admin' : 'employee';\r\n    \r\n    // Save additional user data to Firestore\r\n    await setDoc(doc(db, 'users', user.uid), {\r\n      uid: user.uid,\r\n      email: email,\r\n      firstName: firstName,\r\n      lastName: lastName,\r\n      position: position,\r\n      role: role,\r\n      hashedPassword: hashedPassword, // Store hashed password\r\n      createdAt: new Date(),\r\n      isActive: true\r\n    });\r\n    \r\n    return {\r\n      success: true,\r\n      user: {\r\n        uid: user.uid,\r\n        email: user.email,\r\n        displayName: user.displayName,\r\n        role: role\r\n      }\r\n    };\r\n  } catch (error) {\r\n    console.error('Registration error:', error);\r\n    return {\r\n      success: false,\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\n// Sign in user\r\nexport const signInUser = async (email, password) => {\r\n  try {\r\n    const userCredential = await signInWithEmailAndPassword(auth, email, password);\r\n    const user = userCredential.user;\r\n    \r\n    // Get user data from Firestore\r\n    const userDoc = await getDoc(doc(db, 'users', user.uid));\r\n    const userData = userDoc.data();\r\n    \r\n    return {\r\n      success: true,\r\n      user: {\r\n        uid: user.uid,\r\n        email: user.email,\r\n        displayName: user.displayName,\r\n        role: userData?.role || 'employee',\r\n        firstName: userData?.firstName,\r\n        lastName: userData?.lastName,\r\n        position: userData?.position\r\n      }\r\n    };\r\n  } catch (error) {\r\n    console.error('Sign in error:', error);\r\n    return {\r\n      success: false,\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\n// Sign out user\r\nexport const signOutUser = async () => {\r\n  try {\r\n    await signOut(auth);\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error('Sign out error:', error);\r\n    return {\r\n      success: false,\r\n      error: error.message\r\n    };\r\n  }\r\n};\r\n\r\n// Listen to auth state changes\r\nexport const onAuthStateChange = (callback) => {\r\n  return onAuthStateChanged(auth, callback);\r\n};\r\n\r\n// Get current user\r\nexport const getCurrentUser = () => {\r\n  return auth.currentUser;\r\n};\r\n"],"mappings":"AAAA,OACEA,8BAA8B,CAC9BC,0BAA0B,CAC1BC,OAAO,CACPC,kBAAkB,CAClBC,aAAa,KACR,eAAe,CACtB,OAASC,GAAG,CAAEC,MAAM,CAAEC,MAAM,KAAQ,oBAAoB,CACxD,OAASC,IAAI,CAAEC,EAAE,KAAQ,UAAU,CAEnC;AACA,KAAM,CAAAC,YAAY,CAAG,KAAO,CAAAC,QAAQ,EAAK,CACvC,KAAM,CAAAC,OAAO,CAAG,GAAI,CAAAC,WAAW,CAAC,CAAC,CACjC,KAAM,CAAAC,IAAI,CAAGF,OAAO,CAACG,MAAM,CAACJ,QAAQ,CAAC,CACrC,KAAM,CAAAK,UAAU,CAAG,KAAM,CAAAC,MAAM,CAACC,MAAM,CAACC,MAAM,CAAC,SAAS,CAAEL,IAAI,CAAC,CAC9D,KAAM,CAAAM,SAAS,CAAGC,KAAK,CAACC,IAAI,CAAC,GAAI,CAAAC,UAAU,CAACP,UAAU,CAAC,CAAC,CACxD,MAAO,CAAAI,SAAS,CAACI,GAAG,CAACC,CAAC,EAAIA,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,QAAQ,CAAC,CAAC,CAAE,GAAG,CAAC,CAAC,CAACC,IAAI,CAAC,EAAE,CAAC,CACrE,CAAC,CAED;AACA,MAAO,MAAM,CAAAC,YAAY,CAAG,KAAO,CAAAC,QAAQ,EAAK,CAC9C,GAAI,CACF,KAAM,CAAEC,KAAK,CAAEpB,QAAQ,CAAEqB,SAAS,CAAEC,QAAQ,CAAEC,QAAS,CAAC,CAAGJ,QAAQ,CAEnE;AACA,KAAM,CAAAK,cAAc,CAAG,KAAM,CAAAnC,8BAA8B,CAACQ,IAAI,CAAEuB,KAAK,CAAEpB,QAAQ,CAAC,CAClF,KAAM,CAAAyB,IAAI,CAAGD,cAAc,CAACC,IAAI,CAEhC;AACA,KAAM,CAAAC,cAAc,CAAG,KAAM,CAAA3B,YAAY,CAACC,QAAQ,CAAC,CAEnD;AACA,KAAM,CAAAP,aAAa,CAACgC,IAAI,CAAE,CACxBE,WAAW,IAAAC,MAAA,CAAKP,SAAS,MAAAO,MAAA,CAAIN,QAAQ,CACvC,CAAC,CAAC,CAEF;AACA,KAAM,CAAAO,IAAI,CAAGT,KAAK,CAACU,WAAW,CAAC,CAAC,CAACC,QAAQ,CAAC,OAAO,CAAC,EAAIX,KAAK,CAACU,WAAW,CAAC,CAAC,CAACC,QAAQ,CAAC,gBAAgB,CAAC,CAAG,OAAO,CAAG,UAAU,CAE3H;AACA,KAAM,CAAApC,MAAM,CAACD,GAAG,CAACI,EAAE,CAAE,OAAO,CAAE2B,IAAI,CAACO,GAAG,CAAC,CAAE,CACvCA,GAAG,CAAEP,IAAI,CAACO,GAAG,CACbZ,KAAK,CAAEA,KAAK,CACZC,SAAS,CAAEA,SAAS,CACpBC,QAAQ,CAAEA,QAAQ,CAClBC,QAAQ,CAAEA,QAAQ,CAClBM,IAAI,CAAEA,IAAI,CACVH,cAAc,CAAEA,cAAc,CAAE;AAChCO,SAAS,CAAE,GAAI,CAAAC,IAAI,CAAC,CAAC,CACrBC,QAAQ,CAAE,IACZ,CAAC,CAAC,CAEF,MAAO,CACLC,OAAO,CAAE,IAAI,CACbX,IAAI,CAAE,CACJO,GAAG,CAAEP,IAAI,CAACO,GAAG,CACbZ,KAAK,CAAEK,IAAI,CAACL,KAAK,CACjBO,WAAW,CAAEF,IAAI,CAACE,WAAW,CAC7BE,IAAI,CAAEA,IACR,CACF,CAAC,CACH,CAAE,MAAOQ,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,qBAAqB,CAAEA,KAAK,CAAC,CAC3C,MAAO,CACLD,OAAO,CAAE,KAAK,CACdC,KAAK,CAAEA,KAAK,CAACE,OACf,CAAC,CACH,CACF,CAAC,CAED;AACA,MAAO,MAAM,CAAAC,UAAU,CAAG,KAAAA,CAAOpB,KAAK,CAAEpB,QAAQ,GAAK,CACnD,GAAI,CACF,KAAM,CAAAwB,cAAc,CAAG,KAAM,CAAAlC,0BAA0B,CAACO,IAAI,CAAEuB,KAAK,CAAEpB,QAAQ,CAAC,CAC9E,KAAM,CAAAyB,IAAI,CAAGD,cAAc,CAACC,IAAI,CAEhC;AACA,KAAM,CAAAgB,OAAO,CAAG,KAAM,CAAA7C,MAAM,CAACF,GAAG,CAACI,EAAE,CAAE,OAAO,CAAE2B,IAAI,CAACO,GAAG,CAAC,CAAC,CACxD,KAAM,CAAAb,QAAQ,CAAGsB,OAAO,CAACtC,IAAI,CAAC,CAAC,CAE/B,MAAO,CACLiC,OAAO,CAAE,IAAI,CACbX,IAAI,CAAE,CACJO,GAAG,CAAEP,IAAI,CAACO,GAAG,CACbZ,KAAK,CAAEK,IAAI,CAACL,KAAK,CACjBO,WAAW,CAAEF,IAAI,CAACE,WAAW,CAC7BE,IAAI,CAAE,CAAAV,QAAQ,SAARA,QAAQ,iBAARA,QAAQ,CAAEU,IAAI,GAAI,UAAU,CAClCR,SAAS,CAAEF,QAAQ,SAARA,QAAQ,iBAARA,QAAQ,CAAEE,SAAS,CAC9BC,QAAQ,CAAEH,QAAQ,SAARA,QAAQ,iBAARA,QAAQ,CAAEG,QAAQ,CAC5BC,QAAQ,CAAEJ,QAAQ,SAARA,QAAQ,iBAARA,QAAQ,CAAEI,QACtB,CACF,CAAC,CACH,CAAE,MAAOc,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,gBAAgB,CAAEA,KAAK,CAAC,CACtC,MAAO,CACLD,OAAO,CAAE,KAAK,CACdC,KAAK,CAAEA,KAAK,CAACE,OACf,CAAC,CACH,CACF,CAAC,CAED;AACA,MAAO,MAAM,CAAAG,WAAW,CAAG,KAAAA,CAAA,GAAY,CACrC,GAAI,CACF,KAAM,CAAAnD,OAAO,CAACM,IAAI,CAAC,CACnB,MAAO,CAAEuC,OAAO,CAAE,IAAK,CAAC,CAC1B,CAAE,MAAOC,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,iBAAiB,CAAEA,KAAK,CAAC,CACvC,MAAO,CACLD,OAAO,CAAE,KAAK,CACdC,KAAK,CAAEA,KAAK,CAACE,OACf,CAAC,CACH,CACF,CAAC,CAED;AACA,MAAO,MAAM,CAAAI,iBAAiB,CAAIC,QAAQ,EAAK,CAC7C,MAAO,CAAApD,kBAAkB,CAACK,IAAI,CAAE+C,QAAQ,CAAC,CAC3C,CAAC,CAED;AACA,MAAO,MAAM,CAAAC,cAAc,CAAGA,CAAA,GAAM,CAClC,MAAO,CAAAhD,IAAI,CAACiD,WAAW,CACzB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}